# 2024-01-06
----------------
# ğŸƒ Springboot 

## SpringSecurity
> ìŠ¤í”„ë§ ê¸°ë°˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆì„ ë‹´ë‹¹í•˜ëŠ” ìŠ¤í”„ë§ í•˜ìœ„ í”„ë ˆì„ì›Œí¬
- CSRF ê³µê²©, ì„¸ì…˜ ê³ ì • ê³µê²©ì„ ë°©ì–´í•´ì¤€ë‹¤.
- í•„í„° ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•œë‹¤.

### ì¸ì¦, ì¸ê°€?
- ì¸ì¦ : ì‚¬ìš©ìì˜ ì‹ ì›ì€ ì…ì¦í•˜ëŠ” ê³¼ì • (ex login)
- ì¸ê°€ : ì¸ì¦ ë‹¨ê³„ë¥¼ ê±°ì¹œ ì‚¬ìš©ìë“¤ì˜ ê¶Œí•œ ë° ìê²©ì„ í™•ì¸í•˜ëŠ” ì‘ì—…(ex ì¼ë°˜ìœ ì €ì™€ ê´€ë¦¬ì)

ğŸ—’ï¸WebSecurityConfig.java
```java
package com.devfeat.springbootdeveloper.config;

import com.devfeat.springbootdeveloper.service.UserDetailService;
import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityCustomizer;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;

import static org.springframework.boot.autoconfigure.security.servlet.PathRequest.toH2Console;

@RequiredArgsConstructor
@Configuration
public class WebSecurityConfig {

    private final UserDetailService userService;    // @RequiredArgsConstructor ê°€ ìƒì„±ìë¥¼ ëŒ€ì‹ í•´ì¤Œ

    @Bean
    public WebSecurityCustomizer configure(){   // ì›¹ ë³´ì•ˆ êµ¬ì„± ì»¤ìŠ¤í„°ë§ˆì´ì§•
        return (web -> web.ignoring()   // Security ì„¤ì •ì—ì„œ íŠ¹ì • ìš”ì²­ì„ ë¬´ì‹œí•˜ë„ë¡ ì„¤ì •
                .requestMatchers(toH2Console()) // H2 ë°ì´í„°ë² ì´ìŠ¤ ì½˜ì†”ì— ëŒ€í•œ HTTP ìš”ì²­ì„ ì¸ì¦ ì ˆì°¨ ì—†ì´ í—ˆìš©
                .requestMatchers("/static/**")); // static ë””ë ‰í„°ë¦¬ ë‚´ë¶€ ëª¨ë“  íŒŒì¼ì— ëŒ€í•´ ì¸ì¦ ì ˆì°¨ ì—†ì´ í—ˆìš©
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception { // HttpSecurity ëŠ” springsecurity ì˜ ê±°ì˜ ëŒ€ë¶€ë¶„ ì„¤ì •ì„ ë‹´ë‹¹í•˜ëŠ” ê°ì²´ì´ë‹¤.
        return http
                .authorizeHttpRequests()    // security ì²˜ë¦¬ì— HttpServletRequest ë¥¼ ì´ìš©í•˜ëŠ” ê²ƒì„ ì˜ë¯¸
                .requestMatchers("/login", "/signup", "/user").permitAll()  // /login, /signup, /user ì— ëŒ€í•œ URL ê²½ë¡œì— ëŒ€í•œ ìš”ì²­ì€ ì¸ì¦ ì—†ì´ í—ˆìš©
                .anyRequest().authenticated()   // ê·¸ ì™¸ì˜ ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ì„œ ì¸ì¦ì„ ìš”êµ¬
                .and()
                .formLogin()    // í¼ ë¡œê·¸ì¸ ë§¤ì»¤ë‹ˆì¦˜ í™œì„±í™”
                .loginPage("/login")    // ì‚¬ìš©ì ì •ì˜ ë¡œê·¸ì¸ í˜ì´ì§€ ê²½ë¡œë¥¼ ì„¤ì •
                .defaultSuccessUrl("/articles") // ë¡œê·¸ì¸ ì„±ê³µ í›„ ë¦¬ë””ë ‰ì…˜ë  URL ì„¤ì •
                .and()
                .logout() // ë¡œê·¸ì•„ì›ƒ ë§¤ì»¤ë‹ˆì¦˜ í™œì„±í™”
                .logoutSuccessUrl("/login") // ë¡œê·¸ì•„ì›ƒ ì„±ê³µ í›„ ë¦¬ë””ë ‰ì…˜ë  URL ì„¤ì •
                .invalidateHttpSession(true) // ë¡œê·¸ì•„ì›ƒ ì‹œ Http ì„¸ì…˜ ë¬´íš¨í™”
                .and()
                .csrf().disable()   // Cross Site Request Forgery ë³´í˜¸ ê¸°ëŠ¥ ë¹„í™œì„±í™”
                .build();   // ë¹Œë“œ

                // ìœ„ì™€ ê°™ì€ . ìœ¼ë¡œ ì‡ëŠ” ë°©ì‹ì„ fluent API ë°©ì‹ì´ë¼ê³  í•œë‹¤.
                // fluent API => Domain Specific Languageë¥¼ ë§Œë“¤ì–´ ì½”ë“œ ê°€ë…ì„±ì„ ë†’íŒë‹¤.
    }

    @Bean
    public AuthenticationManager authenticationManager(HttpSecurity http, BCryptPasswordEncoder bCryptPasswordEncoder
    , UserDetailService userDetailService) throws Exception {
        return http.getSharedObject(AuthenticationManagerBuilder.class) // HttpSecurity ê°ì²´ì—ì„œ AuthenticationManagerBuilder ë¥¼ ê°€ì ¸ì˜´
                .userDetailsService(userService)    // ì¸ì¦ ì‹œ userService ë¥¼ ì‚¬ìš©
                .passwordEncoder(bCryptPasswordEncoder)     // bCryptPasswordEncoderë¡œ íŒ¨ìŠ¤ì›Œë“œ ì¸ì½”ë”©
                .and()
                .build();
    }

    @Bean
    public BCryptPasswordEncoder bCryptPasswordEncoder(){
        return new BCryptPasswordEncoder();
    }
}
```


<br><br><br>


## SpringSecurity









# ì •ë³´ì²˜ë¦¬ê¸°ì‚¬ í•„ê¸° ê³µë¶€
SEC.152 ~ SEC.154 + ì–´ì œ ë¶„ëŸ‰ ë³µìŠµ